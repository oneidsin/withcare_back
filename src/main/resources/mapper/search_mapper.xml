<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.withcare.search.dao.SearchDAO">

	<!-- 검색어 저장 -->
	<insert id="insertSearch"
		parameterType="com.withcare.search.dto.SearchDTO">
		INSERT INTO search (sch_id, sch_keyword, sch_type)
		VALUES (#{user_id}, #{sch_keyword}, #{sch_type})
	</insert>

	<!-- 검색 실행 -->
	<select id="getSearchResult"
		parameterType="com.withcare.search.dto.SearchDTO"
		resultType="com.withcare.search.dto.SearchResultDTO">

		SELECT
		p.post_idx,
		p.board_idx,
		p.post_title AS title,
		p.post_content AS content,
		p.id AS writer,
		p.post_create_date AS
		created_date,
		p.post_view_cnt as post_view_cnt
		FROM post p
		LEFT JOIN
		profile pr ON p.id = pr.id
		WHERE p.post_blind_yn = false
		AND
		((p.post_title LIKE CONCAT('%', '하', '%') OR p.post_content LIKE
		CONCAT('%', '', '%'))
		p.id LIKE CONCAT('%%')

		);
	</select>
	<!-- 최근 검색어 (옵션 기능) -->
	<select id="recentSearches" parameterType="String"
		resultType="com.withcare.search.dto.SearchDTO">
		SELECT * FROM search WHERE sch_id = #{user_id} ORDER BY sch_date DESC LIMIT
		10
	</select>

</mapper>


